# /etc/dnsmasq.conf — All-in-one DNS + DHCP + (advertise) NTP for the fake env
# RHEL 9 utility-box reference. Heavily commented on purpose.
# Docs:
# - dnsmasq man page (option names like 'option:ntp-server', 'option:router', 'option:dns-server').
# - OpenShift fake environment from instructions.md.
#
# LISTENING & BINDING
# Listen only on the utility-box IP for DNS and DHCP traffic.
listen-address=10.90.0.3        # This host's IP for DNS
bind-interfaces                # Bind strictly to interfaces with the listen-address
# Optional: restrict to a specific NIC (uncomment and set if desired)
# interface=CHANGE_ME_IFACE    # e.g., interface=ens192

# LOGGING (useful during bring-up; consider disabling later)
log-queries
log-dhcp
# log-facility=/var/log/dnsmasq.log

# DNS MODE
domain-needed                  # Never forward plain names (without dots)
bogus-priv                     # Never forward reverse lookups for RFC1918 ranges
no-resolv                      # Do not read /etc/resolv.conf for upstreams
# Upstream DNS (if connected). If fully disconnected, point to another internal resolver or comment out.
server=1.1.1.1
server=8.8.8.8

# LOCAL DNS AUTHORITATIVE ZONE FOR THE LAB
domain=example.com
local=/example.com/           # Authoritative for example.com
expand-hosts                   # Add domain to simple hostnames in /etc/hosts

# CLUSTER-SPECIFIC A RECORDS (VIPs + registry), per fake env
host-record=api.cluster.example.com,10.90.0.10
# Some installers also query api-int; include it pointing to the same VIP
host-record=api-int.cluster.example.com,10.90.0.10
# Wildcard apps -> Ingress VIP (address= supports wildcards)
address=/.apps.cluster.example.com/10.90.0.11
host-record=registry.example.com,10.90.0.4

# Optionally publish PTRs for the VIPs (reverse DNS). Update octets to match your subnet if desired.
# ptr-record=10.0.90.10.in-addr.arpa,api.cluster.example.com
# ptr-record=11.0.90.10.in-addr.arpa,*.apps.cluster.example.com

# DHCP MODE
# Enable DHCP for the cluster subnet with a dynamic pool and authoritative mode.
dhcp-authoritative
dhcp-range=10.90.0.100,10.90.0.199,255.255.255.0,12h

# DHCPv4 OPTIONS — use human-readable names (dnsmasq maps to correct codes)
# Default gateway (router). CHANGE if your gateway is different.
dhcp-option=option:router,10.90.0.1       # Option 3
# DNS server for clients (point to this dnsmasq)
dhcp-option=option:dns-server,10.90.0.3       # Option 6
# Domain search list (cluster base domain first)
dhcp-option=option:domain-search,cluster.example.com,example.com
# NTP server (chrony on utility-box)
dhcp-option=option:ntp-server,10.90.0.2       # Option 42

# STATIC RESERVATIONS — HA 3 control-plane + 3 worker nodes
# Use the hosts' NIC MAC addresses and pin the IPs. Keep hostnames FQDN.
# Fill in MAC addresses from BMC/BIOS or 'ip link' output and remove CHANGE_ME.
# Control plane (masters) — match static example in instructions.md (10.90.0.20–.22)
dhcp-host=CHANGE_ME_MAC_master0,cluster-master0,cluster-master0.cluster.example.com,10.90.0.20
dhcp-host=CHANGE_ME_MAC_master1,cluster-master1,cluster-master1.cluster.example.com,10.90.0.21
dhcp-host=CHANGE_ME_MAC_master2,cluster-master2,cluster-master2.cluster.example.com,10.90.0.22
# Workers
dhcp-host=CHANGE_ME_MAC_worker0,cluster-worker0,cluster-worker0.cluster.example.com,10.90.0.30
dhcp-host=CHANGE_ME_MAC_worker1,cluster-worker1,cluster-worker1.cluster.example.com,10.90.0.31
dhcp-host=CHANGE_ME_MAC_worker2,cluster-worker2,cluster-worker2.cluster.example.com,10.90.0.32

# OPTIONAL: PXE/TFTP — disabled by default
# enable-tftp
# tftp-root=/var/lib/tftpboot
# pxe-service=x86PC,"PXE Boot",pxelinux

# SECURITY: If using firewalld, open ports: 53/tcp,53/udp (DNS), 67/udp (DHCP server). See README for commands.
